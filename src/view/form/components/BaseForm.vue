<template>
  <BaseForm ref="formRef" :form-item="state.formItem" :rules="state.rules">
    <template #title1>
      <div
        class="text-base font-bold px-4 py-2 bg-gray-100 border-b border-gray-200 mb-3"
      >
        ç”¨æˆ·ä¿¡æ¯è¡¨å•
      </div>
    </template>
    <template #title2>
      <div
        class="text-base font-bold px-4 py-2 bg-gray-100 border-b border-gray-200 mb-3"
      >
        åŸºæœ¬ä¿¡æ¯
      </div>
    </template>
    <template #button>
      <van-button
        type="primary"
        round
        size="large"
        block
        :loading="state.loading"
        @click="state.handleSubmit"
      >
        æäº¤ä¿å­˜
      </van-button>
    </template>
  </BaseForm>
</template>

<script setup lang="ts" name="BaseForm">
import type { FormItemType } from '@/components/BaseForm'
import BaseForm from '@/components/BaseForm'

interface StateType {
  loading: boolean
  formItem: FormItemType[]
  rules: { [key: string]: any }
  handleInSubmit: (_data: any) => void
  handleSubmit: () => void
}

const formRef = ref<InstanceType<typeof BaseForm> | null>(null)

const state = reactive<StateType>({
  loading: false,
  formItem: [
    {
      label: '',
      prop: '',
      value: '',
      fieldType: 'slot',
      slotName: 'title1'
    },
    {
      label: 'ç”¨æˆ·å',
      prop: 'username',
      value: '',
      fieldAttr: {
        placeholder: 'è¯·è¾“å…¥ç”¨æˆ·å'
      }
    },
    {
      label: 'å¯†ç ',
      prop: 'password',
      value: '',
      fieldAttr: {
        placeholder: 'è¯·è¾“å…¥å¯†ç ',
        type: 'password'
      }
    },
    {
      label: 'å‡ºç”Ÿæ—¥æœŸ',
      prop: 'dateBirth',
      value: '',
      fieldType: 'calendar',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'
      },
      attr: {
        title: 'é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'
      }
    },
    {
      label: 'æˆ·ç±åœ°åŒº',
      prop: 'address',
      value: '',
      fieldType: 'area',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©æˆ·ç±åœ°åŒº'
      }
    },
    {
      label: 'å¤é€‰æ¡†1',
      prop: 'hobby1',
      value: ['reading', 'travel'],
      fieldType: 'checkbox',
      data: {
        options: [
          { text: 'çœ‹ä¹¦', value: 'reading' },
          { text: 'æ—…æ¸¸', value: 'travel' }
        ]
      }
    },
    {
      label: 'å¤é€‰æ¡†2',
      prop: 'hobby2',
      value: ['travel', 'photography'],
      fieldType: 'checkboxButton',
      data: {
        options: [
          { text: 'çœ‹ä¹¦', value: 'reading' },
          { text: 'æ—…æ¸¸', value: 'travel' },
          { text: 'ç¾é£Ÿ', value: 'food' },
          { text: 'éŸ³ä¹', value: 'music' },
          { text: 'è¿åŠ¨', value: 'sports' },
          { text: 'ç”µå½±', value: 'movie' },
          { text: 'æ‘„å½±', value: 'photography' },
          { text: 'ç»˜ç”»', value: 'painting' }
        ]
      }
    },
    {
      label: 'æ€§åˆ«',
      prop: 'gender',
      value: '2',
      fieldType: 'radio',
      data: {
        options: [
          { text: 'ç”·', value: '1' },
          { text: 'å¥³', value: '2' }
        ]
      }
    },
    {
      label: '',
      prop: '',
      value: '',
      fieldType: 'slot',
      slotName: 'title2'
    },
    {
      label: 'æ˜¯å¦å·²å©š',
      prop: 'isMarried',
      value: '1',
      fieldType: 'switch'
    },
    {
      label: 'å¼€å§‹ç»“æŸæ—¥æœŸ',
      prop: 'dateRange',
      value: ['2025-10-28', '2025-11-28'],
      fieldType: 'dateRange',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©å¼€å§‹ç»“æŸæ—¥æœŸ'
      },
      attr: {
        title: 'é€‰æ‹©å¼€å§‹æ—¥æœŸ',
        tabs: ['é€‰æ‹©å¼€å§‹æ—¥æœŸ', 'é€‰æ‹©ç»“æŸæ—¥æœŸ'],
        'next-step-text': 'ä¸‹ä¸€æ­¥',
        startAttr: {
          'min-date': new Date(2025, 9, 20)
        }
      }
    },
    {
      label: 'å‡ºå‘æ—¥æœŸæ—¶é—´',
      prop: 'dateTime',
      value: '2026-12-30 16:52:00',
      fieldType: 'dateTime',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©å‡ºå‘æ—¥æœŸæ—¶é—´'
      },
      attr: {
        title: 'å‡ºå‘æ—¶é—´',
        tabs: ['é€‰æ‹©æ—¥æœŸ', 'é€‰æ‹©æ—¶é—´'],
        'next-step-text': 'ä¸‹ä¸€æ­¥'
      }
    },
    {
      label: 'å…¥ä½æ—¥æœŸ',
      prop: 'checkInDate',
      value: '2026-11-29',
      fieldType: 'date',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©å…¥ä½æ—¥æœŸ'
      },
      attr: {}
    },
    {
      label: 'å…¥ä½æ—¶é—´',
      prop: 'checkInTime',
      value: '10:30',
      fieldType: 'time',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©å…¥ä½æ—¶é—´'
      },
      attr: {}
    },
    {
      label: 'æ—¶é—´èŒƒå›´',
      prop: 'appointmentTimeRange',
      value: ['10:00', '12:00'],
      fieldType: 'timeRange',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©æ—¶é—´èŒƒå›´'
      },
      attr: {}
    },
    {
      label: 'è¯ä»¶ç…§ç‰‡',
      prop: 'idPhoto',
      value: [
        {
          status: 'done',
          message: 'ä¸Šä¼ æˆåŠŸ',
          url: 'http://127.0.0.1:81/uploads/20251029/982e915403cde19ddfe023a85fd2c9fe.jpeg'
        }
      ],
      fieldType: 'upload',
      fieldAttr: {
        placeholder: 'è¯·ä¸Šä¼ è¯ä»¶ç…§ç‰‡'
      }
    },
    {
      label: 'å¤‡æ³¨',
      prop: 'remark',
      value: '',
      fieldAttr: {
        type: 'textarea',
        maxlength: 200,
        rows: 1,
        autosize: { minRows: 1, maxRows: 6 },
        //'show-word-limit': true,
        placeholder: 'è¯·è¾“å…¥å¤‡æ³¨'
      }
    },
    {
      label: 'é€‰æ‹©å™¨',
      prop: 'picker',
      value: '0593',
      fieldType: 'picker',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©'
      },
      data: {
        dict: 'week'
      }
    },
    {
      label: 'æ ‡ç­¾é€‰æ‹©å™¨',
      prop: 'pickerTag',
      value: ['3', '6'],
      fieldType: 'pickerTag',
      fieldAttr: {
        placeholder: 'è¯·é€‰æ‹©'
      },
      data: {
        dict: 'hobby'
      },
      attr: { row: 3 }
    }
  ],
  rules: {
    username: [{ required: true, message: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º', trigger: 'onBlur' }]
    /* password: [{ required: true, message: 'å¯†ç ä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
    dateBirth: [
      { required: true, message: 'å‡ºç”Ÿæ—¥æœŸä¸èƒ½ä¸ºç©º', trigger: 'blur' }
    ],
    address: [{ required: true, message: 'åœ°åŒºä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
    appointmentTimeRange: [
      { required: true, message: 'é¢„çº¦æ—¶é—´èŒƒå›´ä¸èƒ½ä¸ºç©º', trigger: 'change' }
    ],
    pickerTag: [
      { required: true, message: 'æ ‡ç­¾é€‰æ‹©å™¨ä¸èƒ½ä¸ºç©º', trigger: 'change' }
    ] */
  },
  //ä½¿ç”¨å†…éƒ¨æŒ‰é’®æäº¤æ–¹æ³•
  handleInSubmit(data) {
    console.log(data)
  },
  //è‡ªå®šæŒ‰é’®æäº¤æ–¹æ³•
  async handleSubmit() {
    state.loading = true
    if (formRef.value) {
      const { code, data } = await formRef.value.onSubmit()
      console.log('ğŸš€ ~ data:', code, data)
      setTimeout(() => {
        state.loading = false
      }, 1000)
    }
  }
})
</script>
